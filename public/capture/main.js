var _=Object.defineProperty;var j=(o,t,e)=>t in o?_(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var i=(o,t,e)=>j(o,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(n){if(n.ep)return;n.ep=!0;const a=e(n);fetch(n.href,a)}})();const R='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M11 18c0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2 2 .9 2 2zm-2-8c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0-6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm6 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zm0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"></path></svg>',V='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 384 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M169.4 470.6c12.5 12.5 32.8 12.5 45.3 0l160-160c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L224 370.8 224 64c0-17.7-14.3-32-32-32s-32 14.3-32 32l0 306.7L54.6 265.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l160 160z"></path></svg>',H='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 24 24" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path fill="none" d="M0 0h24v24H0V0z"></path><path d="M16 9v10H8V9h8m-1.5-6h-5l-1 1H5v2h14V4h-3.5l-1-1zM18 7H6v12c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7z"></path></svg>',K='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 512 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M233.4 406.6c12.5 12.5 32.8 12.5 45.3 0l192-192c12.5-12.5 12.5-32.8 0-45.3s-32.8-12.5-45.3 0L256 338.7 86.6 169.4c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l192 192z"></path></svg>',k='<svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 448 512" height="1em" width="1em" xmlns="http://www.w3.org/2000/svg"><path d="M240.971 130.524l194.343 194.343c9.373 9.373 9.373 24.569 0 33.941l-22.667 22.667c-9.357 9.357-24.522 9.375-33.901.04L224 227.495 69.255 381.516c-9.379 9.335-24.544 9.317-33.901-.04l-22.667-22.667c-9.373-9.373-9.373-24.569 0-33.941L207.03 130.525c9.372-9.373 24.568-9.373 33.941-.001z"></path></svg>';class U{constructor(t,e,s=300,n=!1){i(this,"button");i(this,"container");i(this,"isCollapsed",!1);i(this,"animationDuration",300);i(this,"padding",{top:0,bottom:0});this.button=t,this.container=e,this.animationDuration=s,this.init(),n&&this.collapse()}init(){const t=window.getComputedStyle(this.container);this.padding.top=Math.ceil(parseFloat(t.paddingTop)),this.padding.bottom=Math.ceil(parseFloat(t.paddingBottom)),this.button.innerHTML=k,this.button.addEventListener("click",()=>this.toggleCollapse())}toggleCollapse(){this.isCollapsed?this.expand():this.collapse()}collapse(){this.isCollapsed=!0,this.button.title="Expand",this.container.setAttribute("style",`
      min-height: 0px !important; 
      padding-top: 0px; 
      padding-bottom: 0px; 
      overflow: hidden !important;
      `);const t=this.container.animate([{height:`${this.container.scrollHeight}px`},{height:"0px"}],{duration:this.animationDuration,easing:"ease",fill:"forwards"});t.onfinish=()=>{this.container.setAttribute("data-collapsed",`${this.isCollapsed}`),this.container.classList.remove("expanded"),t.cancel(),this.container.setAttribute("style",`
        height: 0px !important;
        min-height: 0px !important; 
        padding-top: 0px; 
        padding-bottom: 0px; 
        overflow: hidden !important;
        `)},this.button.innerHTML=K}expand(){this.isCollapsed=!1,this.button.title="Collapse";const t=this.container.clientHeight,e=this.container.scrollHeight+this.padding.top+this.padding.bottom;this.container.style.height=`${t}px`,this.container.style.overflow="hidden",this.container.setAttribute("data-collapsed",`${this.isCollapsed}`),this.container.classList.add("expanded");const s=this.container.animate([{height:`${t}px`},{height:`${e}px`}],{duration:this.animationDuration,easing:"ease",fill:"forwards"});s.onfinish=()=>{s.cancel()},this.button.innerHTML=k,s.onfinish=()=>{s.cancel(),this.container.style.height="auto",this.container.style.overflow="",this.container.style.minHeight="",this.container.style.paddingTop="",this.container.style.paddingBottom=""}}}class F{constructor(t,e,s,n=()=>{}){i(this,"container");i(this,"handle");i(this,"isDragging",!1);i(this,"offsetX",0);i(this,"offsetY",0);i(this,"shadowClass","!shadow-2xl");i(this,"name");i(this,"onDragStart");i(this,"onMouseDown",t=>{t.preventDefault(),this.onDragStart(this.container,this.name),this.isDragging=!0,this.offsetX=t.clientX-this.container.offsetLeft,this.offsetY=t.clientY-this.container.offsetTop,this.addElevationStyle()});i(this,"onMouseMove",t=>{this.isDragging&&requestAnimationFrame(()=>{this.container.style.left=`${t.clientX-this.offsetX}px`,this.container.style.top=`${t.clientY-this.offsetY}px`})});i(this,"onMouseUp",()=>{this.isDragging=!1,this.removeElevationStyle()});this.container=t,this.handle=e,this.name=s,this.onDragStart=n,this.handle.addEventListener("mousedown",this.onMouseDown),document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp)}addElevationStyle(){this.container.style.transition="box-shadow 0.3s ease-in-out",this.container.classList.add("dragging",this.shadowClass),this.handle.classList.add("dragging","!cursor-grabbing")}removeElevationStyle(){this.container.classList.remove("dragging",this.shadowClass),this.handle.classList.remove("dragging","!cursor-grabbing"),this.container.style.transition="box-shadow 0.3s ease-in-out"}}function l(o,t,e=!1){var n,a,r;let s=document.createElement(o);if(t&&Object.assign(s,t),typeof e=="string")(n=document.querySelector(e))==null||n.appendChild(s);else if(e===!0)(a=document.querySelector("body"))==null||a.appendChild(s);else if(typeof e=="object"){const d=e;(r=d.appendChild)==null||r.call(d,s)}return s}const b=l("div",{className:"inspector-capture-container",id:"capture-container"}),w=l("div",{className:"saved-sidebar max-h-[calc(100vh-200px)] shadow-lg card bg-base-300 fixed min-w-[300px] max-w-[300px] min-h-[50px] z-[9999] left-[300px] top-[0px] rounded-md border border-[var(--inspector-border-color,gray)]"},b),x=l("div",{className:"capture-sidebar-header bg-[var(--inpector-card-bg)] rounded-t p-3 flex justify-between items-center border-b border-[var(--inspector-border-color,gray)]"},w);l("span",{className:"capture-sidebar-header-title text-[var(--inpector-sidebar-header-title-color)] text-[20px] font-semibold",innerText:"Saved Steps"},x);const A=l("div",{className:"saved-sidebar"},w),P=l("ul",{className:"capture-sidebar-content overscroll-contain menu bg-base-200 rounded max-h-[calc(100vh-456px)] overflow-y-auto block m-3 min-h-[50px]"},A),Z=o=>l("li",{className:"saved-item",innerHTML:`<a><h6 class="text-lg line-clamp-1 ">${o.title}</h6></a>`},P),E=l("div",{className:"capture-sidebar max-h-[calc(100vh-200px)] shadow-lg card bg-base-300 fixed min-w-[300px] max-w-[300px] min-h-[50px] z-[9999] left-0 top-0 rounded-md border border-[var(--inspector-border-color,gray)]"},b),N=l("div",{className:"capture-sidebar-header bg-[var(--inpector-card-bg)] rounded-t p-3 flex justify-between items-center border-b border-[var(--inspector-border-color,gray)]"},E),y=l("div",{className:"card-content p-3"},E),q=(o=N)=>l("button",{className:"btn btn-sm btn-square !cursor-grab border-[var(--inspector-border-color,gray)] hover:border-[var(--inspector-border-color,gray)]",innerHTML:R,title:"Click and drag",draggable:!0},o),z=(o=N)=>l("button",{className:"btn btn-sm btn-outline !ml-auto mr-2  btn-square border-[var(--inspector-border-color,gray)] hover:border-[var(--inspector-border-color,gray)]",title:"Collapse"},o);l("span",{className:"capture-sidebar-header-title text-[var(--inpector-sidebar-header-title-color)] text-[20px] font-semibold",innerText:"Capture"},N);const X=l("input",{className:"capture-sidebar-header-title editableInput line-clamp-1 text-center text-[var(--inpector-sidebar-header-title-color)] text-[20px] font-semibold mb-3"},y),Y=l("ul",{className:"capture-sidebar-content overscroll-contain menu bg-base-200 rounded max-h-[calc(100vh-456px)] overflow-y-auto block min-h-[50px]"},y),G=(o,t,e=!1)=>l("li",{className:"capture-sidebar-item relative !my-[9px]",innerHTML:`
      <a class="block">
      <h6 class="text-lg line-clamp-1">${o}</h6>
      <p class="text-xs line-clamp-2 text-gray-500">${t}</p>
      <p class="text-center absolute -bottom-[18px] left-0 right-0 flex items-center justify-center z-[2] text-gray-300  step-arrow">${V}</p>
      </a>`},e),I=l("div",{className:"card-actions justify-end mt-4"},y),p=({innerText:o,className:t="btn-neutral",container:e=!1,...s})=>l("button",{className:`btn ${t} btn-sm`,innerText:o,...s},e),g=({elementType:o="input",type:t,placeholder:e,className:s="",container:n=!1,required:a=!1,label:r="",...d})=>{const c=l("label",{className:"form-control w-full",innerHTML:` 
      <div class="label">
        <span class="label-text">${r}${a?"*":""}</span>
      </div>`},n),m=l(o,{className:`inspector-input ${o==="input"?"input input-bordered w-full ":"textarea textarea-bordered w-full "} ${s}`,...o==="input"?{type:t}:{rows:3},placeholder:e,required:a,...d},c);return{inputLabel:c,input:m}},J=p({innerText:"Start New",container:I,className:"btn-success"}),W=p({innerText:"Save",container:I,className:"mr-auto "}),$=l("dialog",{className:"modal",id:"capture-modal"},b),O=l("form",{className:"modal-box",id:"capture-dialog-card",onsubmit:o=>o.preventDefault()},$),Q=l("div",{className:"capture-dialog-container space-y-4"},O),tt=l("div",{className:"capture-dialog-container modal-action"},O),v={_id:"",title:"",learned:!1,steps:[],url:""};class et{constructor(t,e,s=()=>{}){i(this,"ui");i(this,"container");i(this,"collapseButton",z());i(this,"sidebarDragHandle",q());i(this,"modal");i(this,"startButton");i(this,"stepData",v);i(this,"modalFooterContainer");i(this,"started",!1);i(this,"modalContentContainer");i(this,"saveButton",W);i(this,"sidebarUl",Y);i(this,"resumeButton",p({innerText:"Resume",type:"button"}));i(this,"listTitle",X);i(this,"cardActions",I);i(this,"paused",!1);i(this,"name");i(this,"onContainerClick");this.ui=t,this.container=E,this.modal=$,this.startButton=J,this.modalContentContainer=Q,this.modalFooterContainer=tt,this.name=e,this.onContainerClick=s,this.init()}init(){new U(this.collapseButton,y),this.initButtons(),this.initInspector(),this.container.onclick=()=>{this.onContainerClick(this.container,this.name)}}initDND(t,e){new F(this.container,this.sidebarDragHandle,t,e)}initInspector(){this.ui.inspector.onElementClick=(t,e)=>{const s=this.ui.inspector.elements.targetElement;b.contains(s)||e.success&&this.openCaptureDialog(e.selector)}}handleOpenEditModal(t){this.openCaptureDialog(t.target,t),this.saveButton.disabled=!1}initButtons(){this.saveButton.disabled=!0,this.resumeButton.disabled=!0,this.startButton.onclick=()=>{this.listTitle.value="",this.resumeButton.disabled=!0,this.saveButton.disabled=!0,this.stepData=v,this.sidebarUl.innerHTML="",this.openNameInputDialog()},this.saveButton.onclick=()=>{this.save()},this.cardActions.appendChild(this.resumeButton),this.resumeButton.onclick=()=>{this.resume()},this.listTitle.oninput=t=>{const e=this.getInputValue(t);this.stepData.title=e;const s=e.length===0||!this.stepData.steps||this.stepData.steps.length===0;this.saveButton.disabled=s}}openNameInputDialog(){var m;this.clearModal();const{input:t,inputLabel:e}=g({placeholder:"Enter Flow Name",type:"text",label:"Flow Name",required:!0});this.stepData.url=((m=window==null?void 0:window.location)==null?void 0:m.href)||"",this.stepData._id=`${this.stepData._id||Date.now()}`;const{input:s,inputLabel:n}=g({elementType:"textarea",placeholder:"Enter Flow Description",label:"Flow Description",type:"text"}),{input:a,inputLabel:r}=g({placeholder:"URL where the flow will execute",label:"Flow URL",type:"text",className:"disabled",disabled:!0,required:!0,value:this.stepData.url}),d=p({innerText:"Start",className:"btn-success",type:"submit"}),c=p({innerText:"Cancel",className:"btn-error",type:"button"});d.onclick=()=>{var h,f;!this.stepData.title||((h=this.stepData.title)==null?void 0:h.length)===0||((f=this.stepData.url)==null?void 0:f.length)===0||(this.started=!0,this.closeModal(),this.startButton.disabled=!0,this.startCapturing())},c.onclick=()=>{this.started=!1,this.closeModal()},t.oninput=h=>{this.stepData.title=this.getInputValue(h),this.listTitle.value=this.stepData.title},s.oninput=h=>{this.stepData.description=this.getInputValue(h)},a.oninput=h=>{this.stepData.url=this.getInputValue(h)},this.modalContentContainer.append(r,e,n),this.modalFooterContainer.append(c,d),this.modal.showModal()}openCaptureDialog(t,e){var L;this.resumeButton.innerText="Resume",this.clearModal(),this.pause();let s={title:(e==null?void 0:e.title)??"",description:(e==null?void 0:e.description)??"",target:t||"",_id:(e==null?void 0:e._id)??`${Date.now()}`};const{input:n,inputLabel:a}=g({placeholder:"Enter Step Name",type:"text",label:"Step Name",required:!0,value:(e==null?void 0:e.title)||""}),{input:r,inputLabel:d}=g({elementType:"textarea",placeholder:"Enter Step Description",label:"Step Description",type:"text",value:(e==null?void 0:e.description)||""}),{input:c,inputLabel:m}=g({placeholder:"Step Target",label:"Step Target",type:"text",className:"disabled",disabled:!0,required:!0,value:t||""}),h=p({innerText:"Pause",className:"btn-error mr-auto",type:"button"}),f=p({innerText:"Next",className:"btn-success btn-outline",type:"submit"}),M=p({innerText:"Finish",className:"btn-success",type:"button"}),S=p({innerText:"Re-Capture",className:"btn-error  btn-outline",type:"button"});if(n.oninput=u=>{s.title=this.getInputValue(u)},r.oninput=u=>{s.description=this.getInputValue(u)},c.oninput=u=>{s.target=this.getInputValue(u)},S.onclick=()=>{this.resume(),this.clearModal(),this.closeModal()},f.onclick=()=>{var u;!s.title||((u=s.title)==null?void 0:u.length)===0||(this.stepData.steps=this.stepData.steps||[],this.stepData.steps.push(s),this.resume(),this.clearModal(),this.closeModal(),this.addListItem(s))},h.onclick=()=>{this.pause(),this.resumeButton.disabled=!1},M.onclick=()=>{var u;s.title&&((u=s.title)==null?void 0:u.length)>0&&(this.stepData.steps=this.stepData.steps||[],this.stepData.steps.push(s),this.addListItem(s)),this.pause(),this.startButton.disabled=!1,this.resumeButton.disabled=!1},e){const u=p({innerText:"Update",className:"btn-success",type:"button"}),B=p({innerText:"Cancel",className:"btn-error ml-auto",type:"button"});B.onclick=()=>{this.closeModal(),this.clearModal()},u.onclick=()=>{var T;!s.title||((T=s.title)==null?void 0:T.length)===0||(this.closeModal(),this.clearModal(),this.updateStepContent(s))},this.modalFooterContainer.append(B,u)}else this.stepData.steps&&((L=this.stepData.steps)==null?void 0:L.length)>0&&(this.modalFooterContainer.append(M),this.saveButton.disabled=!1),this.modalFooterContainer.append(h),this.modalFooterContainer.append(S,f);this.modalContentContainer.append(m,a,d),this.modal.showModal()}updateStepContent(t){var s;const e=(s=this.stepData.steps)==null?void 0:s.findIndex(n=>n._id===t._id);e===void 0||e===-1||!this.stepData||!this.stepData.steps||!this.stepData.steps[e]||(this.stepData.steps[e]=t,this.renderStepDataList(this.stepData))}addListItem(t){const e=G(t.title,t.description||"",this.sidebarUl);l("button",{className:"btn btn-sm btn-error btn-outline !text-[var(--error)] btn-square border-[var(--inspector-border-color,gray)] hover:border-[var(--inspector-border-color,gray)]",innerHTML:H,title:"Delete Step",onclick:s=>{var n;s.preventDefault(),s.stopPropagation(),this.saveButton.disabled=!1,this.removeItemFromStepData((n=this.stepData.steps)==null?void 0:n.findIndex(a=>a._id===t._id),e)}},e),e.onclick=()=>{this.handleOpenEditModal(t)}}renderStepDataList(t){!t||t.steps.length===0||(this.sidebarUl.innerHTML="",this.listTitle.value=t.title,t.steps.forEach(e=>{this.addListItem(e)}),this.stepData=t,this.resumeButton.disabled=!1)}removeItemFromStepData(t,e){var s,n;t===void 0||t===-1||(this.sidebarUl.removeChild(e),(s=this.stepData.steps)==null||s.splice(t,1),((n=this.stepData.steps)==null?void 0:n.length)===0&&(this.saveButton.disabled=!0,this.stepData=v,this.listTitle.value="",this.pause()))}pause(){this.closeModal(),this.clearModal(),this.ui.inspector.pause(),this.paused=!0,this.resumeButton.disabled=!1}resume(){this.resumeButton.disabled=!0,this.paused=!1,this.ui.inspector.resume()}startCapturing(){this.started=!0,this.ui.inspector.startCapturing()}stopCapturing(){this.ui.inspector.stopCapturing(),this.closeModal(),this.clearModal(),this.startButton.disabled=!1}clearModal(){this.modalContentContainer.innerHTML="",this.modalFooterContainer.innerHTML=""}closeModal(){this.modal.close(),this.clearModal()}getInputValue(t){const e=t.target;return e&&e.value||""}async save(){if(this.clearModal(),this.closeModal(),this.stopCapturing(),!this.ui.indexedDb.isDBReady){alert("Database is not ready yet. Please try again later.");return}try{if(!this.stepData._id){alert("Something went wrong. Please try again later.");return}await this.ui.indexedDb.getSingleItem(this.stepData._id)?await this.ui.indexedDb.updateData(this.stepData._id,this.stepData):await this.ui.indexedDb.addData(this.stepData),await this.ui.savedStepUI.fetchData(),console.log(this.stepData),this.stepData=v,this.listTitle.value="",this.sidebarUl.innerHTML="",this.saveButton.disabled=!0,this.resumeButton.disabled=!0}catch(t){console.error(t)}}}class st{constructor(t,e,s=()=>{},n=w){i(this,"ui");i(this,"container",w);i(this,"savedSidebarHeader",x);i(this,"savedSidebarUl",P);i(this,"collapseButton",z(x));i(this,"savedSidebarDragHandle",q(x));i(this,"stepData",[]);i(this,"interval");i(this,"retryConnection",0);i(this,"name");i(this,"onContainerClick");this.container=n,this.ui=t,new U(this.collapseButton,A),this.name=e,this.onContainerClick=s,this.init()}async init(){this.container.onclick=()=>{this.onContainerClick(this.container,this.name)};try{this.interval=setInterval(async()=>{if(this.retryConnection>10){alert("Database is not ready yet. Please try again later."),clearInterval(this.interval);return}this.ui.indexedDb.isDBReady?(console.log("DB is ready"),clearInterval(this.interval),await this.fetchData()):(this.retryConnection++,console.log("DB is not ready yet"))},1e3)}catch(t){console.error(t)}}initDND(t,e){new F(this.container,this.savedSidebarDragHandle,t,e)}renderStepData(){this.savedSidebarUl.innerHTML="",this.stepData.forEach(t=>{const e=Z(t);e.onclick=()=>{var s;(s=this.ui.captureUI)==null||s.renderStepDataList(t)},l("button",{className:"btn btn-sm btn-square btn-error btn-outline !text-[var(--error)] border-[var(--inspector-border-color,gray)] hover:border-[var(--inspector-border-color,gray)]",innerHTML:H,title:"Delete Flow",onclick:s=>{s.preventDefault(),s.stopPropagation(),this.deleteStepData(t)}},e),this.savedSidebarUl.appendChild(e)})}async deleteStepData(t){try{await this.ui.indexedDb.deleteData(t._id),await this.fetchData()}catch(e){console.error(e)}}async fetchData(){if(!this.ui.indexedDb.isDBReady){alert("Database is not ready yet. Please try again later.");return}try{const t=await this.ui.indexedDb.getStoreData();return this.stepData=t,this.renderStepData(),t}catch(t){console.error(t)}}}const it=window.location.host,nt=`${it}-step-data`,at="steps",ot="indexed-db";class rt{constructor({dbName:t=ot,storeName:e,uniqueKey:s,debug:n=!1,version:a=1}){i(this,"isDBReady",!1);i(this,"version");i(this,"dbName");i(this,"storeName");i(this,"key");i(this,"debug");this.version=a,this.isDBReady=!1,this.dbName=t,this.storeName=e,this.key=s,this.debug=n,this.init()}async init(){await this.handleInitDB()}async handleInitDB(){const e=await(async()=>new Promise((s,n)=>{const a=indexedDB.open(this.dbName,this.version);a.onupgradeneeded=()=>{const r=a.result;r.objectStoreNames.contains(this.storeName)||(this.debug&&console.log("Creating users store"),r.createObjectStore(this.storeName,{keyPath:this.key}))},a.onsuccess=()=>{const r=a.result;this.version=r.version,s(r)},a.onerror=()=>{n(a.error)}}))();this.isDBReady=!!e}addData(t){return(async()=>new Promise(s=>{const n=indexedDB.open(this.dbName,this.version);n.onsuccess=()=>{this.debug&&console.log("request.onsuccess - addData",t),n.result.transaction(this.storeName,"readwrite").objectStore(this.storeName).add(t),s(t)},n.onerror=()=>{var r;const a=(r=n.error)==null?void 0:r.message;s(a||"Unknown error")}}))()}deleteData(t){return(async()=>new Promise(s=>{const n=indexedDB.open(this.dbName,this.version);n.onsuccess=()=>{this.debug&&console.log("request.onsuccess - deleteData",t);const c=n.result.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(t);c.onsuccess=()=>{s(!0)},c.onerror=()=>{s(!1)}}}))()}updateData(t,e){return(async()=>new Promise(n=>{const a=indexedDB.open(this.dbName,this.version);a.onsuccess=()=>{this.debug&&console.log("request.onsuccess - updateData",t);const c=a.result.transaction(this.storeName,"readwrite").objectStore(this.storeName),m=c.get(t);m.onsuccess=()=>{const h={...m.result,...e};c.put(h),n(h)},m.onerror=()=>{n(null)}}}))()}getSingleItem(t){return(async()=>new Promise(s=>{const n=indexedDB.open(this.dbName,this.version);n.onsuccess=()=>{this.debug&&console.log("request.onsuccess - getSingleData");const a=n.result;if(!a)return null;const c=a.transaction(this.storeName,"readonly").objectStore(this.storeName).get(t);c.onsuccess=()=>{s(c.result)}}}))()}getStoreData(){return new Promise(e=>{const s=indexedDB.open(this.dbName,this.version);s.onsuccess=()=>{this.debug&&console.log("request.onsuccess - getAllData");const d=s.result.transaction(this.storeName,"readonly").objectStore(this.storeName).getAll();d.onsuccess=()=>{e(d.result)}}})}}class lt{constructor(t){i(this,"inspector");i(this,"captureUI");i(this,"savedStepUI");i(this,"indexedDb");this.inspector=t,this.indexedDb=new rt({storeName:at,uniqueKey:"_id",dbName:nt,version:4}),this.captureUI=new et(this,"captureUI",this.handleZIndex.bind(this)),this.savedStepUI=new st(this,"savedStepUI",this.handleZIndex.bind(this)),this.initDND()}show(){document.body.appendChild(b)}hide(){try{document.body.removeChild(b)}catch{}}initDND(){this.savedStepUI.initDND("savedStepUI",this.handleZIndex.bind(this)),this.captureUI.initDND("captureUI",this.handleZIndex.bind(this))}handleZIndex(t,e){t.style.zIndex="10000",e==="captureUI"?this.savedStepUI.container.style.zIndex="9999":this.captureUI.container.style.zIndex="9999"}}class dt{constructor(t,e,s){i(this,"inspector");i(this,"hoverElement");i(this,"isHoverElementAddedToDOM");i(this,"targetElement");i(this,"targetElementData");i(this,"highlightColor");i(this,"falseHighlightColor");this.inspector=t,this.isHoverElementAddedToDOM=!1,this.createHoverElement(),this.highlightColor=e,this.falseHighlightColor=s}createHoverElement(){this.hoverElement=this.createElement("div",{className:"inspector-hover-element border-2 border-red-500 fixed z-[1305]"}),this.hoverElement.style.position="fixed",this.hoverElement.style.pointerEvents="none",this.hoverElement.style.zIndex="1305"}addElementToDom(){this.isHoverElementAddedToDOM||(this.isHoverElementAddedToDOM=!0,document.body.appendChild(this.hoverElement))}removeElementFromDom(){this.isHoverElementAddedToDOM&&(this.isHoverElementAddedToDOM=!1,document.body.removeChild(this.hoverElement))}getSelector(t){var s,n;if(!t)return null;if(t.id)return"#"+t.id;const e=t.parentElement;if(e!=null&&e.id)return`#${e.id}`;if(t.className){const a=`.${(n=(s=t==null?void 0:t.className)==null?void 0:s.split)==null?void 0:n.call(s," ").join(".")}`;return this.escapeTailwindClassNames(a)}}escapeTailwindClassNames(t){return t.replace(/[^a-zA-Z0-9-_.]/g,"\\$&")}getElementData(t){if(!t)return null;const e=t.tagName.toLowerCase(),s=t.getBoundingClientRect(),n=this.getSelector(t),a=Array.from(t.attributes).reduce((r,d)=>(r[d.name]=d.value,r),{});return{tag:e,attributes:a,selector:n,htmlBox:s,element:t,success:!0}}highlightElement(){let t=this.highlightColor,e="blue";if(this.targetElementData){this.targetElementData.success=!0;try{const r=this.getElementDataFromSelector(this.targetElementData.selector);(!r||(r==null?void 0:r.element)!==this.targetElement)&&(t=this.falseHighlightColor,e="red",this.targetElementData.success=!1)}catch(r){console.warn(r),this.targetElementData.success=!1,e="red",t=this.falseHighlightColor}const n=getComputedStyle(this.targetElement).getPropertyValue("border-radius"),{htmlBox:a}=this.targetElementData;this.hoverElement.style.border=`2px dashed ${e}`,this.hoverElement.style.borderRadius=n,this.hoverElement.style.left=a.left+"px",this.hoverElement.style.top=a.top+"px",this.hoverElement.style.width=a.width+"px",this.hoverElement.style.height=a.height+"px",this.hoverElement.style.backgroundColor=t}}getElementDataFromSelector(t){if(!t)return null;const e=document.querySelector(t);return e?this.getElementData(e):null}createElement(t,e){const s=document.createElement(t);return e&&Object.assign(s,e),s}update(){if(!this.targetElement)return;const t=this.getElementData(this.targetElement);t&&(this.targetElementData=t)}render(){this.highlightElement()}}class ct{constructor(t,e,s=3,n=""){i(this,"inspector");i(this,"countdownInSeconds");i(this,"elements");i(this,"countDown");i(this,"messageContainer");i(this,"counterElement");i(this,"interval");i(this,"timeout");i(this,"isChildPresent",!1);i(this,"messageElement");i(this,"startMessage");this.inspector=t,this.countdownInSeconds=s,this.countDown=s,this.elements=e,this.messageContainer=e.createElement("div"),this.counterElement=e.createElement("h2"),this.messageElement=e.createElement("p",{innerText:"To exit the inspector tool at any time, simply press the Esc key."}),this.startMessage=n,this.init()}init(){this.messageContainer.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.5);
      max-width: 100vw;
      backdrop-filter: blur(10px);
      padding: 50px;
      border-radius: 10px;
      text-align: center;
      color: white;
    `,this.counterElement.style.cssText=`
      font-size: 24px;
      font-weight: bold;
      
    `,this.messageElement.style.cssText=`
      max-width: 300px;
      margin: 15px auto;
      font-size: 18px;
    `;const t=this.elements.createElement("span",{innerText:this.startMessage});this.messageElement.appendChild(t),this.messageContainer.appendChild(this.counterElement),this.messageContainer.appendChild(this.messageElement)}clear(){clearInterval(this.interval),clearTimeout(this.timeout),this.countDown=this.countdownInSeconds,this.isChildPresent&&document.body.removeChild(this.messageContainer)}showCountdown(t){this.counterElement.textContent=this.countDown.toString(),document.body.appendChild(this.messageContainer),this.isChildPresent=!0,this.interval=setInterval(()=>{this.countDown--,this.counterElement.textContent=this.countDown.toString()},1e3),this.timeout=setTimeout(()=>{document.body.removeChild(this.messageContainer),this.isChildPresent=!1,this.countDown=this.countdownInSeconds,t()},this.countdownInSeconds*1e3)}}class ht{constructor({onElementClick:t,update:e,startMessage:s="",countdownTimeInSeconds:n=3,highlightColor:a="rgba(0,0,255,0.3)",falseHighlightColor:r="rgba(255, 0, 0, 0.3)"}){i(this,"isInspecting");i(this,"boundKeydown");i(this,"boundMousedown");i(this,"boundMouseOver");i(this,"boundContextMenu");i(this,"elements");i(this,"isListenerAttached");i(this,"onElementClick");i(this,"updateFN");i(this,"messages");i(this,"ui");this.isListenerAttached=!1,this.isInspecting=!1,this.elements=new dt(this,a,r),this.onElementClick=t,this.updateFN=e,this.messages=new ct(this,this.elements,n,s),this.ui=new lt(this)}show(){this.ui.show()}hide(){this.ui.hide()}addEventListeners(){this.isListenerAttached||(this.isListenerAttached=!0,this.boundKeydown=this.handleKeydown.bind(this),this.boundMousedown=this.handleMouseDown.bind(this),this.boundMouseOver=this.handleMouseOver.bind(this),this.boundContextMenu=this.handleContextMenu.bind(this),document.addEventListener("keydown",this.boundKeydown),document.addEventListener("mousedown",this.boundMousedown),document.addEventListener("mouseover",this.boundMouseOver),document.addEventListener("contextmenu",this.boundContextMenu))}removeEventListeners(){this.isListenerAttached&&(this.isListenerAttached=!1,document.removeEventListener("keydown",this.boundKeydown),document.removeEventListener("mousedown",this.boundMousedown),document.removeEventListener("mouseover",this.boundMouseOver),document.removeEventListener("contextmenu",this.boundContextMenu))}handleKeydown(t){t.key==="Escape"&&this.stopCapturing(),t.key==="ḍ"&&t.altKey&&t.ctrlKey&&(this.isInspecting?this.stopCapturing():this.startCapturing())}handleMouseDown(t){t.preventDefault(),t.stopPropagation(),this.isInspecting&&(t.preventDefault(),t.stopPropagation(),this.onElementClick&&typeof this.onElementClick=="function"&&this.onElementClick(t,this.elements.targetElementData))}handleMouseOver(t){if(!this.isInspecting)return;const e=t.target;this.elements.targetElement=e}handleContextMenu(t){this.isInspecting&&(t.preventDefault(),t.stopPropagation())}pause(){this.stopCapturing()}resume(){this.addEventListeners(),this.isInspecting=!0,this.elements.addElementToDom(),requestAnimationFrame(t=>this.animate(t))}stopCapturing(){this.elements.removeElementFromDom(),this.isInspecting=!1,this.removeEventListeners(),this.messages.clear()}startCapturing(){const t=()=>{this.addEventListeners(),this.isInspecting=!0,this.elements.addElementToDom(),window.requestAnimationFrame(e=>this.animate(e))};this.messages.showCountdown(t)}animate(t){this.isInspecting&&(this.update(t),this.render(),requestAnimationFrame(this.animate.bind(this)))}update(t){this.elements.update(),this.updateFN&&typeof this.updateFN=="function"&&this.updateFN(t)}render(){this.elements.render()}}class ut{constructor(){i(this,"inspector",new ht({}))}start(){this.inspector.show()}stop(){this.inspector.hide()}async getAllData(){var t;try{return await((t=this.inspector)==null?void 0:t.ui.indexedDb.getStoreData())}catch(e){console.error(e)}}}const C=o=>{chrome.runtime.sendMessage({action:"messageFromContent",data:o},function(t){t&&console.log(t)})},D=new ut;chrome.runtime.onMessage.addListener(async(o,t,e)=>{if(o.action==="start"&&(D.start(),C({response:"started",data:[]})),o.action==="stop"&&(D.stop(),C({response:"stoped",data:[]})),o.action==="sendStepData"){D.stop();const s=await D.getAllData();C({response:"data",data:s})}});
